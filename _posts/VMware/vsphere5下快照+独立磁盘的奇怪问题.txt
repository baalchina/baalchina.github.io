Title: vsphere5下快照+独立磁盘的奇怪问题
Date: 2012-02-23 14:39:36
URL: /2012/02/vsphere5-disk-snapsho/

vspher5，windows2003系统，两块盘，一块20g，一块250g，其中第二块是独立磁盘。添加磁盘2前（还是后？忘了。。。）做过一次快照。

由于想克隆以下这台机器，但是独立磁盘不支持，所以想把独立去掉。

于是找了半天google，无果，想用convert，但是太慢，停机太长。后来关掉虚拟机之后发现，居然那个独立的勾可以去掉....

于是去掉，确定，克隆之。这时候又提示又快照无法操作，于是把快照了。启动。问题来了。

Vsphere提示

打开虚拟机 vm-72 的电源时，从 ESX 主机接收到意外错误。 原因: 系统找不到指定的文件。 无法打开磁盘“vh-000001.vmdk”或其所依赖的快照磁盘之一。
VMware ESX 找不到虚拟磁盘“vh-000001.vmdk”。请确认路径有效并重试。
无法打开磁盘“vh-000001.vmdk”或其所依赖的快照磁盘之一。

于是我晕了...

折腾半天，小紧张了一下，最后的解决方法是：

1.  删掉第一块磁盘，第二块磁盘不动。记得别把vmdk也删了。选择从虚拟机移除。
2.  启动虚拟机，c盘由于不在，自然启动不了系统。
3.  此时关掉虚机，再次添加磁盘，选择从已存在的磁盘选择，然后选中刚才那个vmdk文件。
4.  启动，一切ok。
其实，俺还不是很明白为什么...看来得去考个vcp。哈哈

ps，网上很多文章说是因为lck文件存在的问题。但是估计说的是workstation。vsphere里面我并没有找到lck文件。

我感觉这个现象应该是快照删除的时候出错了。但是具体为什么，还不确定。